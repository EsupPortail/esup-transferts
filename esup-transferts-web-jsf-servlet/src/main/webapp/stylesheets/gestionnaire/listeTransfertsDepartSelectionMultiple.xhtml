<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:t="http://myfaces.apache.org/tomahawk"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="/stylesheets/gestionnaire/template.xhtml">
	<ui:define name="navigation">
		<ui:include src="/stylesheets/gestionnaire/_include/_header.xhtml"></ui:include>
	</ui:define>
	<ui:define name="corps">
		<p:panel
			rendered="#{!administrationController.personnel || (!administrationController.droitsDepart and !sessionController.currentUser.admin)}">
			<ui:include
				src="/stylesheets/gestionnaire/_include/_unauthorized.xhtml"></ui:include>
		</p:panel>

		<p:spacer height="10px" />
		<h:form id="multiple"
			rendered="#{administrationController.personnel and (administrationController.droitsDepart || sessionController.currentUser.admin)}">
			<p:growl id="msgs" showDetail="false" />
			<p:dataTable var="transferts" styleClass="datatable" id="test"
				style="width:80%;"
				value="#{administrationController.allDemandesTransferts}" rows="10"
				paginator="true" rowsPerPageTemplate="5,10,15,20,25,30,35,40,45,50"
				emptyMessage="Auncune demande de transferts départ"
				selection="#{administrationController.selectedDemandeTransferts}"
				filteredValue="#{administrationController.filteredEtudiantDepartMultiple}" rowSelectMode="add">

				<f:facet name="header">
						Liste des demandes de transferts départ	#{sessionController.currentAnnee}/#{sessionController.currentAnnee+1} 
					</f:facet>

				<!-- 					<f:facet name="header">   -->
				<!--             Liste des demandes de transferts départ #{sessionController.currentAnnee}/#{sessionController.currentAnnee+1}  -->
				<!--             <p:spacer width="10px" /> -->
				<!-- 						<p:selectBooleanButton -->
				<!-- 							value="#{administrationController.switchTraiteNontraite}" -->
				<!-- 							onLabel="Toutes les demandes" offLabel="En cours" -->
				<!-- 							onIcon="ui-icon-check" offIcon="ui-icon-close"> -->
				<!-- 							<p:ajax update=":display" oncomplete="true" -->
				<!-- 								listener="#{administrationController.addMessage}" /> -->
				<!-- 						</p:selectBooleanButton> -->
				<!-- 					</f:facet> -->

				<p:column selectionMode="multiple" style="width:18px" />

				<p:column headerText="Etat" style="width:7%;"
					sortBy="transferts.temoinTransfertValide" id="nb">
					<h:graphicImage alt="avisSaisie" title="En cours"
						value="/media/images/player_pause.png"
						rendered="#{transferts.transferts.temoinTransfertValide==0 || transferts.transferts.temoinTransfertValide==null}" />
					<h:graphicImage alt="avisSaisie" title="Avis saisie"
						value="/media/images/tick.png"
						rendered="#{transferts.transferts.temoinTransfertValide==1}" />
					<h:graphicImage alt="avisSaisie" title="Bloquer"
						value="/media/images/lock.png"
						rendered="#{transferts.transferts.temoinTransfertValide==2}" />
				</p:column>

				<p:column headerText="Opi" style="width:7%;"
					sortBy="transferts.temoinOPIWs">
					<h:graphicImage alt="opiEnvoye" title="Non partenaire"
						value="/media/images/messagebox_info.png"
						rendered="#{transferts.transferts.temoinOPIWs==0}" />
					<h:graphicImage alt="opiEnvoye" title="Envoyée"
						value="/media/images/mail_foward.png"
						rendered="#{transferts.transferts.temoinOPIWs==1}" />
					<h:graphicImage alt="opiEnvoye" title="Problème d'envoi"
						value="/media/images/metacontact_away.png"
						rendered="#{transferts.transferts.temoinOPIWs==2}" />
				</p:column>

				<p:column headerText="Composante actuelle" filterBy="composante"
					style="text-align:left;" sortBy="composante"
					filterMatchMode="contains">
            #{transferts.composante}  
        </p:column>

				<p:column headerText="Dernière IA" filterBy="libEtapePremiereLocal"
					style="text-align:left;" sortBy="libEtapePremiereLocal"
					id="derniereIA">  
            #{transferts.libEtapePremiereLocal}  
        </p:column>

				<p:column headerText="Numéro étudiant" filterBy="numeroEtudiant"
					sortBy="numeroEtudiant">
            #{transferts.numeroEtudiant}  
        </p:column>

				<p:column headerText="Numéro I.N.E" filterBy="numeroIne"
					sortBy="numeroIne">
            #{transferts.numeroIne}  
        </p:column>

				<p:column headerText="Nom" filterBy="nomPatronymique"
					style="text-align:left;" sortBy="nomPatronymique" id="nom">  
            #{transferts.nomPatronymique}  
        </p:column>

				<p:column headerText="Prénom" style="text-align:left;">  
            #{transferts.prenom1}  
        </p:column>

				<!-- 		<p:column headerText="Blocage" style="width:7%;" id="blocage"> -->
				<!-- 			<h:graphicImage alt="avisSaisie" title="Interdits" -->
				<!-- 				value="/media/images/player_pause.png" -->
				<!-- 				rendered="#{transferts.interdit || transferts.interditLocal}" /> -->
				<!-- 		</p:column> -->

				<!-- 					<p:column headerText="Adresse 1" style="text-align:left;">   -->
				<!--             #{transferts.adresse.libAd1}   -->
				<!--         </p:column> -->

				<f:facet name="footer">  
            Total #{administrationController.totalDepart} demande(s) de transfert départ.  
        </f:facet>
			</p:dataTable>

			<p:spacer height="20" />
			<center>
				<p:panel id="avis" header="Saisie d'un avis" toggleable="true"
					style="width:80%;" collapsed="true" closable="true"
					toggleSpeed="500" closeSpeed="500" widgetVar="avis">
					<h:panelGrid columns="4" columnClasses="column" cellpadding="5"
						style="text-align:left;">

						<h:outputText value="Date du jour : " />
						<h:outputText id="dateDuJour"
							value="#{administrationController.dateDuJour}" />
						<p:spacer />
						<p:spacer />

						<h:outputText value="Etat du dossier : " />
						<p:selectOneMenu id="etatDossier"
							value="#{administrationController.currentAvis.idEtatDossier}"
							required="true" requiredMessage="#{msgs['ERREUR.ETAT_DOSSIER']}">
							<f:selectItem itemLabel="== Choix ==" itemValue="" />
							<f:selectItems
								value="#{administrationController.listeEtatsDossier}" />
						</p:selectOneMenu>
						<h:outputText value="Motif : " />
						<p:inputText id="motifEtatDossier" size="50"
							value="#{administrationController.currentAvis.motifEtatDossier}" />

						<h:outputText value="Localisation du dossier : " />
						<p:selectOneMenu id="localisationDossier"
							value="#{administrationController.currentAvis.idLocalisationDossier}"
							required="true"
							requiredMessage="#{msgs['ERREUR.LOCALISATION_DOSSIER']}">
							<f:selectItem itemLabel="== Choix ==" itemValue="" />
							<f:selectItems
								value="#{administrationController.listeLocalisationDossier}" />
						</p:selectOneMenu>
						<h:outputText value="Motif : " />
						<p:inputText id="motifLocalisationDossier" size="50"
							value="#{administrationController.currentAvis.motifLocalisationDossier}" />

						<h:outputText value="Décision : " />
						<p:selectOneMenu id="decisionDossier"
							value="#{administrationController.currentAvis.idDecisionDossier}"
							required="true"
							requiredMessage="#{msgs['ERREUR.DECISION_DOSSIER']}">
							<f:selectItem itemLabel="== Choix ==" itemValue="" />
							<f:selectItems
								value="#{administrationController.listeDecisionsDossier}" />
							<!-- 								<p:ajax event="blur" update="commune,msgs,msgs2,growl" /> -->
							<!-- 								<p:ajax event="change" update=":currentAvis:bouton" /> -->
						</p:selectOneMenu>
						<h:outputText value="Motif : " />
						<p:inputText id="motifDecisionDossier" size="50"
							value="#{administrationController.currentAvis.motifDecisionDossier}" />
					</h:panelGrid>
					<p:spacer height="20" />

<!-- 					<h:outputText value="Barre de chargement : " style="width:7%;" /> -->
<!-- 					<p:progressBar widgetVar="pbAjax" ajax="true" style="width:50%" -->
<!-- 						value="#{administrationController.progress}" -->
<!-- 						labelTemplate="{value}%" styleClass="animated"> -->
<!-- 						<p:ajax event="complete" -->
<!-- 							listener="#{administrationController.onComplete}" -->
<!-- 							update=":multiple:msgs,:multiple:test" -->
<!-- 							oncomplete="startButton2.enable()" /> -->
<!-- 					</p:progressBar> -->

<!-- 					<p:spacer height="40" /> -->

<!-- 					<p:commandButton value="Valider" icon="ui-icon-search" update="msgs" -->
<!-- 						widgetVar="startButton2" -->
<!-- 						action="#{administrationController.addAvisFavorableMultiple}" /> -->
<!-- 					<p:commandButton value="Cancel" -->
<!-- 						actionListener="#{administrationController.cancel}" -->
<!-- 						oncomplete="pbAjax.cancel();startButton2.enable();" /> -->

					<p:commandButton value="Valider" onclick="confirmation.show()" type="button"
						action="#{administrationController.addAvisOuDecisionMultiple}" update=":multiple:msgs,:multiple:test" />

				</p:panel>
				
			<p:confirmDialog
				message="Attention, la validation en masse peut prendre quelques minutes..."
				header="Confirmation" severity="alert" widgetVar="confirmation">
				<p:commandButton value="Oui"
					update=":multiple:msgs,:multiple:test"
					oncomplete="confirmation.hide()"
					action="#{administrationController.addAvisOuDecisionMultiple}" />
				<p:commandButton value="Non" onclick="confirmation.hide()"
					actionListener="#{administrationController.destroyWorld}" type="button" />
			</p:confirmDialog>	
			
			</center>
		</h:form>
		<p:spacer height="20" />
		<center>
			<p:panel header="Légende" toggleable="true" style="width:80%;"
				collapsed="true" closable="true" toggleSpeed="500" closeSpeed="500"
				widgetVar="panel"
				rendered="#{administrationController.personnel and (administrationController.droitsDepart || sessionController.currentUser.admin)}">
				<h:panelGrid columns="6" cellpadding="10">
					<h:panelGrid columns="6" cellpadding="10">
						<p:graphicImage value="/media/images/player_pause.png" />
						<h:outputText value="Non traité" />
						<p:graphicImage value="/media/images/tick.png" />
						<h:outputText value="En cours de traitement" />
						<p:graphicImage value="/media/images/lock.png" />
						<h:outputText value="Traité" />
						<p:graphicImage value="/media/images/metacontact_away.png" />
						<h:outputText value="Problème de transfert OPI" />
						<p:graphicImage value="/media/images/messagebox_info.png" />
						<h:outputText value="Etablissement non partenaire" />
						<p:graphicImage value="/media/images/mail_foward.png" />
						<h:outputText value="Infos OPI transmises" />
					</h:panelGrid>
					<!-- 						<p:commandButton id="chartBtn" value="Statistiques" type="button" /> -->
					<!-- 						<p:overlayPanel id="chartPanel" for="chartBtn" hideEffect="fade"> -->
					<!-- 						<h3>JFreeChart on-the-fly</h3> -->
					<!-- 						<p:graphicImage value="#{statistiqueController.chart}" /> -->
					<p:pieChart id="custom"
						value="#{statistiqueController.pieModelDepart}" legendPosition="e"
						fill="false" showDataLabels="true"
						title="Transferts départ #{sessionController.currentAnnee}/#{sessionController.currentAnnee+1}"
						style="width:400px;height:300px" sliceMargin="5" diameter="150" />

					<!-- 						<p:pieChart id="sample" -->
					<!-- 							value="#{statistiqueController.pieModelDepart}" -->
					<!-- 							legendPosition="w" title="Statistiques" -->
					<!-- 							style="width:300px;height:200px" /> -->
					<!-- 						</p:overlayPanel> -->
				</h:panelGrid>
			</p:panel>
		</center>
	</ui:define>

	<!-- 	<ui:define name="content"> -->
	<!-- 		<ui:include src="/stylesheets/_include/_footer.xhtml"></ui:include> -->
	<!-- 	</ui:define> -->

</ui:composition>
</html>
